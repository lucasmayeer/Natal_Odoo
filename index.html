<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natal Solid√°rio - Odoo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Inter:wght@300;400;600;700;800&family=Mountains+of+Christmas:wght@700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        odoo: {
                            base: '#714B67', // Roxo Odoo
                            light: '#8f6a85',
                            dark: '#5a3750',
                            accent: '#00E891' // Verde Odoo (aprox) para detalhes
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #714B67; /* Roxo Odoo Base */
            /* Padr√£o de textura sutil de linhas (grid) */
            background-image: 
                linear-gradient(90deg, transparent 50%, rgba(255,255,255,0.05) 50%),
                linear-gradient(0deg, transparent 50%, rgba(255,255,255,0.05) 50%);
            background-size: 50px 50px;
        }

        .handwritten {
            font-family: 'Indie Flower', cursive;
        }

        .christmas-font {
            font-family: 'Mountains of Christmas', cursive;
        }
        
        /* Classe espec√≠fica para a fonte Inter */
        .font-inter {
            font-family: 'Inter', sans-serif;
        }

        #letterModal, #teamModal {
            transition: opacity 0.3s ease-in-out;
        }

        .paper-texture {
            background-color: #fff;
            background-image: radial-gradient(#f0f0f0 1px, transparent 1px);
            background-size: 20px 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .team-input {
            border: none;
            border-bottom: 2px solid #e5e7eb;
            transition: border-color 0.3s;
        }
        .team-input:focus {
            outline: none;
            border-bottom-color: #714B67;
        }
        
        /* Estilos para a Pagina√ß√£o */
        .pagination-button {
            padding: 0.5rem 1rem;
            background-color: white;
            color: #714B67; /* odoo-base */
            font-weight: bold;
            border-radius: 0.375rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
            border: none;
        }
        .pagination-button:hover:not(:disabled) {
            background-color: #714B67;
            color: white;
        }
        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination-button.active {
            background-color: #714B67;
            color: white;
        }

        /* Estilo das Abas de Navega√ß√£o */
        .nav-tab {
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 9999px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Estado Ativo: Branco Brilhante */
        .nav-tab.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            backdrop-filter: blur(4px);
        }
        
        /* Estado Inativo: Transparente/Opaco */
        .nav-tab.inactive {
            background-color: transparent;
            color: rgba(255, 255, 255, 0.5);
            border-color: transparent;
        }
        
        .nav-tab.inactive:hover {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen pb-12 text-gray-800 flex flex-col">

    <!-- Header Limpo com Logo Centralizada -->
    <header class="pt-8 pb-4 relative z-10 text-center">
        <div class="container mx-auto px-4">
            <!-- Logo Container -->
            <div class="w-full max-w-[280px] mx-auto mb-6">
                <img src="odoo_logo_inverted.svg" 
                     alt="Logo Odoo" 
                     class="w-full h-auto object-contain drop-shadow-2xl brightness-110 filter hover:scale-105 transition-transform duration-500">
            </div>
            
            <h1 class="text-3xl md:text-4xl text-white font-bold tracking-wide uppercase christmas-font drop-shadow-md">Natal Solid√°rio Odoo</h1>
        </div>
    </header>

    <!-- Navega√ß√£o entre Sess√µes -->
    <div class="container mx-auto px-4 mb-8">
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 font-inter">
            <button onclick="window.switchTab('info')" id="tab-info" class="nav-tab active">
                <i data-lucide="info" class="w-5 h-5"></i>
                Sobre o Projeto
            </button>
            <button onclick="window.switchTab('cards')" id="tab-cards" class="nav-tab inactive">
                <i data-lucide="gift" class="w-5 h-5"></i>
                Adotar uma Estrelinha
            </button>
        </div>
    </div>

    <!-- Conte√∫do Principal -->
    <main class="container mx-auto px-4 flex-grow relative">
        
        <!-- SESS√ÉO 1: INFORMA√á√ïES (Sobre o Projeto) -->
        <div id="view-info" class="animate-fade-in max-w-5xl mx-auto">
            <div class="grid md:grid-cols-12 gap-6">
                
                <!-- Coluna Principal: Boas Vindas -->
                <div class="md:col-span-12 bg-white rounded-2xl shadow-xl overflow-hidden font-inter">
                    <div class="bg-odoo-dark p-8 text-center relative overflow-hidden">
                        <!-- C√≠rculos decorativos -->
                        <div class="absolute top-0 left-0 w-32 h-32 bg-white/5 rounded-full -translate-x-10 -translate-y-10"></div>
                        <div class="absolute bottom-0 right-0 w-48 h-48 bg-white/5 rounded-full translate-x-10 translate-y-10"></div>
                        
                        <h2 class="text-3xl font-bold text-yellow-400 mb-4 relative z-10">Ol√°, Odooers! üíú</h2>
                        <p class="text-white text-lg font-light leading-relaxed max-w-2xl mx-auto relative z-10">
                            Este espa√ßo foi criado para conectarmos nossos times aos sonhos destas crian√ßas. 
                            A magia do Natal acontece quando nos unimos por uma causa maior.
                        </p>
                    </div>
                    
                    <div class="p-8">
                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Card: Como Funciona -->
                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="w-12 h-12 bg-purple-100 text-odoo-base rounded-lg flex items-center justify-center mb-4">
                                    <i data-lucide="heart-handshake" class="w-6 h-6"></i>
                                </div>
                                <h3 class="font-bold text-gray-800 text-lg mb-2">Como Funciona?</h3>
                                <p class="text-gray-600 text-sm leading-relaxed">
                                    Navegue at√© a aba de cartinhas, escolha uma crian√ßa e registre o nome do seu <strong>Time</strong> para apadrinhar o sonho dela.
                                </p>
                            </div>

                            <!-- Card: Prazo -->
                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="w-12 h-12 bg-yellow-100 text-yellow-700 rounded-lg flex items-center justify-center mb-4">
                                    <i data-lucide="calendar-clock" class="w-6 h-6"></i>
                                </div>
                                <h3 class="font-bold text-gray-800 text-lg mb-2">Prazo Importante</h3>
                                <p class="text-gray-600 text-sm leading-relaxed">
                                    O per√≠odo para adotar uma crian√ßa vai at√© o dia <strong class="text-odoo-base">05/12</strong>. N√£o deixe para a √∫ltima hora!
                                </p>
                            </div>

                            <!-- Card: Entrega -->
                            <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                                <div class="w-12 h-12 bg-green-100 text-green-700 rounded-lg flex items-center justify-center mb-4">
                                    <i data-lucide="map-pin" class="w-6 h-6"></i>
                                </div>
                                <h3 class="font-bold text-gray-800 text-lg mb-2">Ponto de Entrega</h3>
                                <div class="text-gray-600 text-sm leading-relaxed">
                                    <p class="mb-2">
                                        Iremos entregar no dia <strong class="text-odoo-base">12/12</strong> na ag√™ncia dos Correios mais pr√≥xima da Odoo:<br>
                                        <span class="font-semibold text-gray-800">R. Mal. Deodoro, 298 ‚Äì Centro</span>
                                    </p>
                                    <p class="text-xs text-gray-500 italic border-t border-gray-200 pt-2">
                                        Neste meio tempo, iremos manter todos os presentes na mesa da √°rvore de Natal. üéÑ
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Banner Inferior: Orienta√ß√µes -->
                <div class="md:col-span-12">
                    <div class="bg-gradient-to-r from-odoo-light to-odoo-base rounded-2xl p-6 text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-6 font-inter border-2 border-white/20">
                        <div class="flex items-start gap-4">
                            <div class="bg-white/20 p-3 rounded-full shrink-0">
                                <i data-lucide="gift" class="w-8 h-8 text-yellow-300"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg text-yellow-300 mb-1">Preparando o Presente</h3>
                                <p class="text-white/90 text-sm">
                                    Lembre-se: o presente deve estar <strong>embrulhado</strong> e <strong>etiquetado</strong> com a cartinha da crian√ßa.
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-black/20 px-4 py-3 rounded-lg shrink-0">
                            <i data-lucide="life-buoy" class="w-5 h-5 text-white/70"></i>
                            <div class="text-sm">
                                <p class="font-bold">Precisa de ajuda?</p>
                                <p class="text-white/80 text-xs">O Backoffice est√° dispon√≠vel para apoiar.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bot√£o de A√ß√£o -->
                <div class="md:col-span-12 text-center mt-4">
                    <button onclick="window.switchTab('cards')" class="bg-yellow-400 hover:bg-yellow-500 text-odoo-dark font-bold py-4 px-10 rounded-full shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 text-lg flex items-center gap-2 mx-auto font-inter">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        Quero Adotar uma Cartinha Agora!
                    </button>
                </div>

            </div>
        </div>

        <!-- SESS√ÉO 2: CARTINHAS (Grid) -->
        <div id="view-cards" class="hidden animate-fade-in">
            <!-- Grid ajustado para 3 colunas no m√°ximo -->
            <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Cards gerados via JS -->
                <div class="col-span-full text-center text-white py-12">
                    <p class="text-xl">Carregando cartinhas...</p>
                </div>
            </div>
            
            <!-- Container da Pagina√ß√£o -->
            <div id="pagination-container" class="flex justify-center items-center gap-2 mb-8">
                <!-- Bot√µes de pagina√ß√£o gerados via JS -->
            </div>
        </div>

    </main>

    <!-- Modal de Leitura da Carta -->
    <div id="letterModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full overflow-hidden transform transition-all scale-95 opacity-0" id="letterModalContent">
            
            <!-- Modal Header -->
            <div class="bg-odoo-base p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-2">
                    <i data-lucide="mail-open" class="w-5 h-5"></i>
                    <h3 class="font-bold text-lg" id="modalTitle">Visualizando Carta</h3>
                </div>
                <button onclick="window.closeModal('letterModal')" class="hover:bg-odoo-dark p-1 rounded-full transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Modal Body (A Carta) -->
            <div class="p-6 bg-yellow-50 overflow-y-auto max-h-[70vh] relative flex flex-col items-center">
                <div class="paper-texture border border-gray-200 p-8 shadow-md rotate-1 transform mx-auto max-w-md relative w-full mb-6">
                    <div class="absolute top-4 right-4 text-red-400 opacity-50">
                        <i data-lucide="stamp" class="w-12 h-12"></i>
                    </div>
                    <!-- Texto Transcrito -->
                    <p class="text-sm text-gray-400 mb-4 font-mono text-right">Natal 2024</p>
                    <div class="handwritten text-2xl text-blue-900 leading-loose" id="modalText">
                        <!-- Texto inserido via JS -->
                    </div>
                </div>

                <!-- Bot√£o de Download da Imagem -->
                <a id="downloadBtn" href="#" download class="flex items-center gap-2 bg-white text-odoo-base border-2 border-odoo-base font-bold py-2 px-6 rounded-full hover:bg-odoo-base hover:text-white transition-colors shadow-sm">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    Baixar Cartinha Original
                </a>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 bg-gray-50 border-t flex justify-end gap-3">
                <button onclick="window.closeModal('letterModal')" class="px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg font-bold transition-colors">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Sele√ß√£o de Time -->
    <div id="teamModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all scale-95 opacity-0" id="teamModalContent">
            
            <div class="bg-yellow-400 p-4 text-yellow-900 flex justify-between items-center">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    Selecione seu Time
                </h3>
                <button onclick="window.closeModal('teamModal')" class="hover:bg-yellow-500 p-1 rounded-full transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-6">
                <p class="text-gray-600 mb-4 text-sm font-inter">Qual time da Odoo est√° adotando esta estrelinha?</p>
                <select id="teamSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-odoo-base focus:outline-none bg-white text-gray-700 font-inter">
                    <option value="" disabled selected>Escolha um time...</option>
                </select>
                <p class="text-xs text-red-500 mt-2 font-inter">Aten√ß√£o: Ao confirmar, a carta ser√° bloqueada para outros times.</p>
            </div>

            <div class="p-4 bg-gray-50 border-t flex justify-end gap-3">
                <button onclick="window.closeModal('teamModal')" class="px-4 py-2 text-gray-500 hover:bg-gray-200 rounded-lg font-bold font-inter">Cancelar</button>
                <button onclick="window.saveTeamSelection()" class="px-6 py-2 bg-odoo-base hover:bg-odoo-dark text-white rounded-lg font-bold shadow transition-colors font-inter">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-white/60 mt-auto pb-4 text-sm font-light pt-8">
        <p>¬© 2024 Odoo Natal Solid√°rio.</p>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configura√ß√£o Firebase
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Estado Global
        let currentAdoptions = {};
        let currentChildIdForTeam = null;
        let currentPage = 1;
        const itemsPerPage = 15;

        // --- Lista de Times ---
        const teamsList = [
            "Time de Backoffice",
            "Time de Customer Success",
            "Time do ARRA",
            "Time do GUAM",
            "Time da JESM",
            "Time da LUPA",
            "Time do GAMA",
            "Time do NACE",
            "Time do BRCA",
            "Time do GABN",
            "Time do RODM",
            "Time do LCOR",
            "Time do RHSA",
            "Time da NIME",
            "Time do HMAZ",
            "Time do SCLO",
            "Time do JAPO",
            "Time do Lub (Gerentes)"
        ];

        // --- Dados das Cartinhas (18 Cartas no total) ---
        // IDs removidos: 1658482, 1660394, 1652962
        const childrenData = [
            { id: "1652416", name: "Daniel", age: 4, gender: "Masculino", request: "Carrinho de controle remoto", spec: "CARRINHO DE CONTROLE REMOTO AZUL", letterText: "Ol√°, Meu nome √© Daniel e tenho 4 anos. Gosto de brincar com carrinhos. Gostaria de ganhar um carrinho de controle remoto azul. Obrigado Papai Noel üöó", thumbColor: "bg-blue-100" },
            { id: "1652572", name: "Alice", age: 5, gender: "Feminino", request: "Casa de boneca", spec: "CASA DE BONECA LADYBUG", letterText: "Ol√°, meu nome √© Alice e tenho 5 anos. Gosto de brincar de bonecos e gostaria de ganhar uma casa de boneca da Ladybug. Obrigado Papai Noel üêû", thumbColor: "bg-pink-100" },
            { id: "1652746", name: "Davi Gabriel", age: 5, gender: "Masculino", request: "Pista de corrida", spec: "PISTA DE CORRIDA HOTWHEELS", letterText: "Ol√°, Meu nome √© Davi Gabriel e tenho 5 anos. Brinco de boneco homem aranha e moto. Gostaria de ganhar uma pista de corrida. Obrigado Papai Noel üèéÔ∏è", thumbColor: "bg-orange-100" },
            { id: "1653354", name: "Melissa", age: 5, gender: "Feminino", request: "Boneca", spec: "BONECA COM MALA DE ROUPA", letterText: "Ol√°, meu nome √© Melissa tenho 5 anos gostaria de ganhar uma boneca com malas de roupas. Obrigado papai noel üëó", thumbColor: "bg-pink-100" },
            { id: "1653767", name: "Miguel", age: 4, gender: "Masculino", request: "Boneco", spec: "BONECO DO SONIC", letterText: "meu nome √© miguel e eu adoro o sonic, por isso quero do Papai Noel um Sonic, eu vou brincar muito com ele! ü¶î", thumbColor: "bg-blue-100" },
            { id: "1654249", name: "Thomas", age: 4, gender: "Masculino", request: "Hot wheels", spec: "PISTA DA HOT WHEELS", letterText: "meu nome √© Thomas e quero ganhar uma pista da Hotweels üèéÔ∏è", thumbColor: "bg-orange-100" },
            { id: "1654586", name: "Elo√°", age: 3, gender: "Feminino", request: "Roupa", spec: "4 ROUPAS ROSA E MAQUINA DE BOLHAS", letterText: "PAPAI NOEL, MEU NOME √â ELO√Å E GOSTARIA DE GANHAR UMA MAQUINA DE BOLHA DE SAB√ÉO E ROUPAS ROSA ü´ß", thumbColor: "bg-purple-100" },
            { id: "1655949", name: "Gustavo", age: 4, gender: "Masculino", request: "Boneco", spec: "BONECO DO HOMEM ARANHA", letterText: "PAPAI NOEL, GOSTARIA DE GANHAR UMA TEIA E BRINQUEDO DO HOMEM ARANHA E ROUPAS. MEU NOME √â GUSTAVO üï∑Ô∏è", thumbColor: "bg-red-100" },
            { id: "1658529", name: "Annalice", age: 5, gender: "Feminino", request: "Boneca", spec: "BEBE REBORN", letterText: "Annalice, 5 anos. Adora brincar de casinha no canto das bonecas. Seu pedido foi uma beb√™ reborn com acess√≥rios que facilitam a vida das mam√£es como chupeta e mamadeira. üë∂", thumbColor: "bg-teal-100" },
            { id: "1659952", name: "Marya Kanandra", age: 6, gender: "Feminino", request: "Boneca", spec: "UM BEBE REBORN E UM CARRINHO DE BONECA", letterText: "Marya Kanandra tem um jeitinho doce e encantador. Ela adora brincar de boneca. Seu maior desejo √© ganhar uma beb√™ reborn e um carrinho de boneca. üçº", thumbColor: "bg-purple-100" },
            { id: "1659978", name: "Arielly", age: 5, gender: "Feminino", request: "Boneca", spec: "BEBE REBORN E BOLINHA DE SABAO", letterText: "Arielly tem 5 anos √© uma menina doce e sonhadora. Ela ama brincar de boneca. O seu sonho √© ganhar uma beb√™ reborn e bolha de sab√£o. ü´ß", thumbColor: "bg-pink-100" },
            { id: "1660010", name: "Chloe", age: 6, gender: "Feminino", request: "Boneca", spec: "BEBE REBORN E SLIME", letterText: "Chloe tem 6 anos e √© uma crian√ßa cheia de energia e sonhadora. Ela ama brincar de bonecas e seu sonho √© ganhar uma beb√™ reborn e uma slime. üíñ", thumbColor: "bg-purple-100" },
            { id: "1660286", name: "Lucca", age: 5, gender: "Masculino", request: "Pista de Carrinho", spec: "PISTA DE CARRINHO COBRA DA HOT WHEELS", letterText: "Lucca tem 5 anos e ama brincar de carrinho. Seu sonho √© ganhar uma pista de carrinho de cobra da Hot Wheels. üêç", thumbColor: "bg-yellow-100" },
            { id: "1660943", name: "Benicio", age: 6, gender: "Masculino", request: "Carrinho de controle remoto", spec: "CARRINHO DE CONTROLE REMOTO E PIPA", letterText: "Benicio, 6 anos, adora brincar com carros, seu momento preferido do dia √© quando aposta qual corre mais rapido com os colegas. Seu desejo √© ter um de controle remoto e uma pipa. ü™Å", thumbColor: "bg-blue-100" },
            { id: "1661027", name: "Calebe", age: 5, gender: "Masculino", request: "Carrinho de controle remoto", spec: "UM CARRINHO DE CONTROLE REMOTO E UMA PIPA", letterText: "Calebe, 5 anos, menino alegre e cheio de energia. Adora brincar com carros, os preferidos s√£o os que ganham as corridas que faz com os colegas. Seu desejo √© ter um de controle remoto e uma pipa. ü™Å", thumbColor: "bg-green-100" },
            { id: "1889235", name: "Laura", age: 8, gender: "Feminino", request: "Boneca Kit slimeKit", spec: "BEBE REBORN KIT DE SLIME KIT DE CABELO", letterText: "FELIZ NATAL PAPAI NOEL VOCE PODE MIDAR UMA BEBE REBORN E UM CITI DE ISLAIME E DE ARUMAR CABELO", thumbColor: "bg-pink-100" },
            { id: "1897050", name: "Lara", age: 8, gender: "Feminino", request: "Patinete Livro", spec: "PATINETE 2 RODAS UM PRESENTE PRA IRM√É DE 1 ANO", letterText: "QUERIDO NOEL MEU NOME √â LARA E TENHO 8 ANOS E QUERIA UM PATINETE DE 2 RODAS O QUE ME DEU QUEBROU E PRA MINHA IRM√É PODE TRAZE QUALQUER COISA ELA TEM 1 ANO EO NOME √â RADASA. üõ¥", thumbColor: "bg-yellow-100" },
            { id: "1904825", name: "Heloisa", age: 8, gender: "Feminino", request: "Material Escolar", spec: "GARRAFINHA DE √ÅGUA DA CAPIVARA", letterText: "QUERIDO PAPAI NOEL. EU QUERO UM KIT DE CAPIVARA COMPLETO DE MATERIAL ESCOLAR COM GARRAFA E ATE APAGADOR DE CANETA. MEU NOME √â HELOISA COIMBRA EU J√Å VOU FAZER 8 ANOS DIA 19 DE FEVEREIRO E EU SOU AQUARIANA. FELIZ NATAL HO HO HO ü¶¶", thumbColor: "bg-green-100" }
        ];

        // --- Inicializa√ß√£o e Auth ---
        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Erro na autentica√ß√£o:", error);
            }
        }

        // Listener de Ado√ß√µes em Tempo Real
        function setupRealtimeListener() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const adoptionsRef = collection(db, 'artifacts', appId, 'public', 'data', 'adoptions');
                    
                    onSnapshot(adoptionsRef, (snapshot) => {
                        const newAdoptions = {};
                        snapshot.forEach((doc) => {
                            newAdoptions[doc.id] = doc.data().team;
                        });
                        currentAdoptions = newAdoptions;
                        window.renderCards(currentPage); // Re-renderiza com os dados novos
                    }, (error) => {
                        console.error("Erro ao ouvir dados:", error);
                    });
                }
            });
        }

        // --- Fun√ß√µes Expostas para o HTML (Window) ---

        window.renderCards = function(page = 1) {
            const container = document.getElementById('cards-container');
            if (!container) return;
            container.innerHTML = '';

            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = childrenData.slice(startIndex, endIndex);

            paginatedData.forEach(child => {
                let teamButtonHTML;
                const adoptedBy = currentAdoptions[child.id]; // Verifica no banco de dados
                
                if (adoptedBy) {
                    // Estado: J√Å ADOTADO (Bloqueado)
                    teamButtonHTML = `
                        <button class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded shadow cursor-default flex items-center justify-center gap-2 opacity-90">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            <span class="truncate">Adotado por: ${adoptedBy}</span>
                        </button>
                    `;
                } else {
                    // Estado: DISPON√çVEL
                    teamButtonHTML = `
                        <button onclick="window.openTeamModal('${child.id}')" class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-4 rounded shadow transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="users" class="w-4 h-4"></i>
                            Selecionar Time
                        </button>
                    `;
                }

                const titlePrefix = child.gender === 'Masculino' ? 'Cartinha do' : 'Cartinha da';
                const cardTitle = `${titlePrefix} ${child.name}`;

                const cardHTML = `
                    <div class="bg-white rounded-lg shadow-xl overflow-hidden hover:shadow-2xl transition-all duration-300 flex flex-col h-full border-b-4 border-odoo-base group">
                        <div class="h-28 ${child.thumbColor} relative flex items-center justify-center border-b border-dashed border-gray-300">
                            <div class="bg-white p-3 shadow-md transform group-hover:-rotate-6 transition-transform duration-300 rounded-sm">
                                <i data-lucide="file-text" class="w-8 h-8 text-odoo-base"></i>
                            </div>
                            <div class="absolute top-2 right-2">
                                <span class="bg-white/90 px-2 py-1 rounded text-xs font-bold text-gray-500 shadow-sm">#${child.id}</span>
                            </div>
                        </div>

                        <div class="p-5 flex-grow flex flex-col text-left">
                            <div class="mb-4 space-y-2">
                                <h3 class="text-xl font-bold text-gray-800 christmas-font tracking-wide">${cardTitle}</h3>
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p><span class="font-bold text-odoo-base">Idade:</span> ${child.age} anos</p>
                                    <p><span class="font-bold text-odoo-base">Sexo:</span> ${child.gender}</p>
                                    <p><span class="font-bold text-odoo-base">Pedido:</span> ${child.request}</p>
                                    <p><span class="font-bold text-odoo-base">Detalhe:</span> ${child.spec}</p>
                                </div>
                            </div>
                            <div class="mt-auto space-y-3 pt-4 border-t border-gray-100">
                                <button onclick="window.openModal('${child.id}')" class="w-full bg-odoo-base hover:bg-odoo-dark text-white font-bold py-2 px-4 rounded shadow transition-colors flex items-center justify-center gap-2">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                    Ler Cartinha
                                </button>
                                ${teamButtonHTML}
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });
            
            if (typeof lucide !== 'undefined') lucide.createIcons();
            window.renderPagination();
        }

        window.renderPagination = function() {
            const container = document.getElementById('pagination-container');
            if (!container) return;
            container.innerHTML = '';
            
            const totalPages = Math.ceil(childrenData.length / itemsPerPage);
            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.innerHTML = '<i data-lucide="chevron-left" class="w-5 h-5"></i>';
            prevButton.className = 'pagination-button flex items-center justify-center';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => window.changePage(currentPage - 1);
            container.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.innerText = i;
                pageButton.className = `pagination-button ${i === currentPage ? 'active' : ''}`;
                pageButton.onclick = () => window.changePage(i);
                container.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.innerHTML = '<i data-lucide="chevron-right" class="w-5 h-5"></i>';
            nextButton.className = 'pagination-button flex items-center justify-center';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => window.changePage(currentPage + 1);
            container.appendChild(nextButton);

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        window.populateTeamSelect = function() {
            const select = document.getElementById('teamSelect');
            select.innerHTML = '<option value="" disabled selected>Escolha um time...</option>';
            teamsList.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.innerText = team;
                select.appendChild(option);
            });
        }

        window.openTeamModal = function(id) {
            currentChildIdForTeam = id;
            document.getElementById('teamSelect').value = "";
            const modal = document.getElementById('teamModal');
            const content = document.getElementById('teamModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.saveTeamSelection = async function() {
            const select = document.getElementById('teamSelect');
            const selectedTeam = select.value;
            
            if (!selectedTeam) {
                alert("Por favor, selecione um time.");
                return;
            }

            if (!auth.currentUser) {
                alert("Aguarde a conex√£o com o sistema...");
                return;
            }

            try {
                // SALVA NO FIREBASE
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'adoptions', currentChildIdForTeam), {
                    team: selectedTeam,
                    timestamp: new Date().toISOString()
                });
                
                window.closeModal('teamModal');
            } catch (e) {
                console.error("Erro ao salvar:", e);
                alert("Houve um erro ao salvar a ado√ß√£o. Tente novamente.");
            }
        }

        window.changePage = function(newPage) {
            const totalPages = Math.ceil(childrenData.length / itemsPerPage);
            if (newPage < 1 || newPage > totalPages) return;
            currentPage = newPage;
            renderCards(currentPage);
            document.getElementById('cards-container').scrollIntoView({ behavior: 'smooth' });
        }

        window.openModal = function(id) {
            const child = childrenData.find(c => c.id === id);
            if (!child) return;

            document.getElementById('modalTitle').innerText = `Visualizando Carta #${child.id}`;
            document.getElementById('modalText').innerText = child.letterText;
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.href = `${child.id}.jpg`;
            
            const modal = document.getElementById('letterModal');
            const content = document.getElementById('letterModalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            const content = modal.querySelector('div[class*="transform"]');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        window.switchTab = function(tabName) {
            const infoView = document.getElementById('view-info');
            const cardsView = document.getElementById('view-cards');
            const tabInfo = document.getElementById('tab-info');
            const tabCards = document.getElementById('tab-cards');

            if (tabName === 'info') {
                infoView.classList.remove('hidden');
                cardsView.classList.add('hidden');
                tabInfo.classList.add('active');
                tabInfo.classList.remove('inactive');
                tabCards.classList.remove('active');
                tabCards.classList.add('inactive');
            } else {
                infoView.classList.add('hidden');
                cardsView.classList.remove('hidden');
                tabCards.classList.add('active');
                tabCards.classList.remove('inactive');
                tabInfo.classList.remove('active');
                tabInfo.classList.add('inactive');
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }
        }

        // Inicializa√ß√£o
        initAuth();
        setupRealtimeListener();
        window.populateTeamSelect();
        window.switchTab('info');

        // Para resetar um card manualmente no console: resetAdoption('ID')
        window.resetAdoption = async (id) => {
             await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'adoptions', id), { team: null }, { merge: true }); // Ou deleteDoc
             console.log("Resetado");
        }

    </script>
</body>
</html>